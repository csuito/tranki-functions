(async () => {
  console.log("Hey!")
  require('dotenv').config()
  const { connectDB, closeDB } = require('../config/db')
  await connectDB()
  const Product = require('../../server/model/products')
  const algoliaClient = require("../config/algolia")()
  const index = algoliaClient.initIndex("products")
  const products = await Product.find({ category: "covid-19", department: "tranki" }).lean()
  const productIDs = products.map(p => p._id)
  const objectIDs = products.map(p => p.objectID)
  console.log({ products: products.length, objectID: objectIDs.length })
  // await Product.deleteMany({ _id: { $in: productIDs } })
  // await index.deleteObjects(objectIDs)
  // await Product.updateMany({ category: "bodegon", department: "mas vendidos" }, { $set: { department: "tranki" } })
  // let productIdsToRemove = products.map(p => p._id)
  // let objectIDS = products.map(p => p.objectID)
  // console.log({ productsToUpdate: products.length })
  // let { results: algoProducts } = await index.getObjects(objectIDS)
  // algoProducts = algoProducts.map(a => ({ ...a, department: "tranki" }))
  // console.log(algoProducts)
  // await index.saveObjects(algoProducts, { autoGenerateObjectIDIfNotExist: false })
  // await Product.deleteMany({ _id: { $in: productIdsToRemove } })
  await closeDB()
})()